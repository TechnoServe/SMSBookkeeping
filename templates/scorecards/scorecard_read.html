{% extends "smartmin/read.html" %}

{% load locales %}
{% load smartmin i18n %}

{% block pre-content %}

<div class="page-header"><h2>{{ title }} <a id="show_scorecard" href="#" onclick="javascript:showViewOptions()" title="Select Scorecard Version" class="btn btn-primary pull-right">{% trans "Download Scorecard" %}</a></h2></div>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="span12">
            <p class="right">
                {% if not scorecard.finalized %}
                    <a href="{% url 'scorecards.scorecard_standards' scorecard.id %}" class="btn"
                       style="font-weight:normal;">{{edit_button}}</a>
                {% endif %}
            </p>
            <table class="table table-striped table-bordered">
                {% for field in attribute_fields %}
                    <tr>
                        <td>{% get_label field %}</td>
                        <td>{% get_value object field %}</td>
                    </tr>
                {% endfor %}
            </table>
            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>{% trans "ID" %}</th>
                    <th>{% trans "Standard" %}</th>
                    <th>{% trans "Type" %}</th>
                    <th>{% trans "Compliance" %}</th>
                </tr>
                </thead>

                <tbody>
                {% for category in standard_categories %}
                    <tr>
                        <td class="category" colspan="4">{{ category }}</td>
                    </tr>
                    {% for standard in season_standards %}
                        {% if standard.category == category %}
                            <tr>
                                <td>{{ standard.acronym }}</td>
                                <td>{{ standard.name }}</td>
                                <td>{{ standard.get_kind_display }}</td>
                                <td class="right">
                                    {% if standard.scorecard_value >= 0 %}
                                        {% if standard.kind == 'BP' %}
                                            {{ standard.scorecard_value }}%
                                        {% else %}
                                            {% if standard.scorecard_value == 100 %}
                                                Pass
                                            {% else %}
                                                Fail
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% if not scorecard.is_finalized %}
    <div class="row">
      <div class="span12">
	<a href ="{% url 'scorecards.scorecard_finalize' scorecard.id %}" class="btn posterize pull-right danger">{% trans "Finalize" %}</a>
      </div>
    </div>
    {% endif %}

  {% if scorecard.is_finalized and amendments|length > 0 %}
  <div class="row">
    <div class="span11 alert-message block-message">
      {% for amendment in amendments %}
      {{amendment.description}} <br/>
      {% endfor %}
    </div>
  </div>  
  {% endif %}

{% endblock content %}

    {% block extra-script %}
    {{ block.super }}
    <script type="text/javascript">
      function getViewContent(){
	  var content = '<center><select id="report_version" class="report-options">' + 
	  {% for language in languages %}
	    '<option value="lang={{ language.language_code }}">{{ language.name }}</option>' +
	  {% endfor %}
	    '</select> <a href="#" onclick="downloadReport()" class="btn btn-primary">Download</a></center>';
	  
	  return content;
      }

      var popoverVisible = false;
      function showViewOptions(){
        if (popoverVisible){
	      $("#show_scorecard").popover("hide");
          popoverVisible = false;
        } else {
	      $("#show_scorecard").popover("show");
          popoverVisible = true;
        }
      }

      function hideViewOptions(){
	    $("#show_scorecard").popover("hide");
      }

      function downloadReport(){
	    hideViewOptions();
	    document.location.href = "{% url 'scorecards.scorecard_pdf' scorecard.id %}?" + $("#report_version").val();
      }

      $(function(){
	  $("#show_scorecard").popover({ trigger: "manual",
				      placement: "bottom",
				      html: true,
				      content: getViewContent
				    });
      });
    </script>
    {% endblock %}
    
    {% block extra-style %}
    {{ block.super }}
    <style>
      td.right {
	  text-align: right;
      }
      
      td.category {
	  font-weight: bold;
	  background-color: #fff !important;
      }
      
      p.right {
	  text-align: right;
      }
    </style>
    {% endblock %}
